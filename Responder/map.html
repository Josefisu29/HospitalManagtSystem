<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Responder Map</title>
    <style>
      #map {
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="nav-inner">
          <div class="nav-toggle" id="navToggle">â˜°</div>
          <ul class="nav-menu" id="navMenu">
            <li>
              <a
                href="Responder/Responder.html"
                class="active"
                aria-current="page"
                >Dashboard</a
              >
            </li>
            <li><a href="Responder/assign.html">Assignment</a></li>
            <li><a href="Responder/reports.html">Report</a></li>
            <li><a href="Responder/map.html">Map</a></li>
          </ul>
        </div>
      </nav>
    </header>
    <div id="map"></div>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
      async
      defer
    ></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCpMkpU9YeB3HNpzk0_fwswSf9TQwb_Xdg",
        authDomain: "hospitalmanagtsystem.firebaseapp.com",
        projectId: "hospitalmanagtsystem",
        storageBucket: "hospitalmanagtsystem.firebasestorage.app",
        messagingSenderId: "771158568788",
        appId: "1:771158568788:web:e47f16ea2577fa1e8762c1",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Initialize the map
      let map;
      window.initMap = function () {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 0, lng: 0 },
          zoom: 2,
        });
      };

      // Listen for new help requests and place markers
      onSnapshot(collection(db, "helpRequests"), (snapshot) => {
        snapshot.docChanges().forEach((change) => {
          if (change.type === "added") {
            const { latitude, longitude, patientId } = change.doc.data();
            const pos = { lat: latitude, lng: longitude };
            new google.maps.Marker({
              position: pos,
              map,
              title: `Patient ID: ${patientId}`,
            });
            map.panTo(pos);
            map.setZoom(14);
          }
        });
      });
    </script>
  </body>
</html>
